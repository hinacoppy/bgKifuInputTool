<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="author" content="(C)hinacoppy 2023">
<link rel="icon" href="icon/favicon.ico">
<link rel="apple-touch-icon" href="icon/apple-touch-icon.png">
<style>
body{
  padding:10px;
  background-color:#efe;
}
.contents{
  padding-left:20px;
}
</style>
<title>BgKifuInputTool help</title>
</head>
<body>
<h1>Backgammon Kifu Input Tool</h1>

<h3>◆このアプリは何？</h3>

<p class="contents">
バックギャモンの棋譜を入力するためのツールです。<br>
eXtreme Gammon 2 (XG) にも棋譜を入力する機能はありますが、棋譜入力に特化して、かつ XG の棋譜入力機能より使いやすいツールとして提供することを目的として開発しました。<br>
マウス操作ができるパソコンで稼働させてください。スマホやタブレットなどのタッチデバイスでも動きますが、正常に動かない可能性があります。<br>
犬さんにツール開発のヒントをいただきました。＞Thanks to 犬さん<br>
<br>
＃動画を自動的に棋譜に変換するツールではありません。こちらも構想はあるのですが、画像認識の壁が高すぎて頓挫している状況です。<br>
</p>

<h3>◆何ができるの？</h3>

<p class="contents">
ビデオで撮影した動画を見ながらこのツールを操作して棋譜を入力します。<br>
入力した棋譜はMAT形式の棋譜ファイルとして出力することができます。<br>
MAT形式の棋譜ファイルは XG や GnuBG で読み込むことができます。解析などはそちらのツールで実行してください。<br>
</p>

<h3>◆どうやって使うの？</h3>

<h4>(1) 準備</h4>
<p class="contents">
・対戦者の名前、マッチポイント数、イベント名、イベント日を入力します。<br>
　→これらの情報は棋譜ファイルにコメントとして記述されます。<br>
・<button><i class="fas fa-check"></i> Begin New Match</button>を押下し、棋譜入力を始めます。<br>
・[Action Panel] はドラッグで動かすことができます。使いやすい場所に移動してください。<br>
</p>
<h4>(2) 棋譜入力</h4>
<p class="contents">
・ダイス一覧が表示され、出目を選択します。<br>
　→オープニングロールでは選択するダイスの色で先攻・後攻を選びます。<br>
　→この画面ではキーボードの 123456 と d の入力を受付けます。<br>
・マウス操作でチェッカーを動かすことができます。<br>
　→チェッカーはドラッグ＆ドロップとクリックのどちらでも操作することができます。<br>
・<button><i class="fas fa-check-circle"></i> Done</button>ボタンを押下するとチェッカー操作を終えます。<br>
　→ダイス部分の左クリックで<button><i class="fas fa-check-circle"></i> Done</button>と同じ機能が動きます。<br>
・<button><i class="fas fa-undo"></i> Undo</button>ボタンを押下するとチェッカー操作をやり直すことができます。<br>
　→ダイス部分の右クリックで<button><i class="fas fa-undo"></i> Undo</button>と同じ機能が動きます。<br>
・<button><i class="fas fa-check-circle"></i> Done</button><button><i class="fas fa-undo"></i> Undo</button>の画面ではキーボードの Enter, Space と Esc を受付けます。<br>
　→ Enter, Space は<button><i class="fas fa-check-circle"></i> Done</button>の機能として、Esc は<button><i class="fas fa-undo"></i> Undo</button>の機能として動きます。<br>
・<button><i class="fas fa-dragon"></i> Forced</button>が押せるときはキーボードの f を受付けます。<br>
</p>
<h4>(3) ダブリング操作</h4>
<p class="contents">
・ダイス一覧画面の<button><i class="fas fa-dice-d6"></i> Double</button>を押下するとダブル提案です。<br>
・ダブルを受けた側は<button><i class="fas fa-thumbs-up"></i> Take</button><button><i class="fas fa-thumbs-down"></i> Pass</button>のいずれかを押下します。<br>
　→<button><i class="fas fa-thumbs-up"></i> Take</button>のときは棋譜入力を継続します。<br>
　→<button><i class="fas fa-thumbs-down"></i> Pass</button>のときはゲーム終了画面が表示されます。<br>
　→<button><i class="fas fa-thumbs-up"></i> Take</button><button><i class="fas fa-thumbs-down"></i> Pass</button>の画面ではキーボードの t と p を受付けます。<br>
</p>
<h4>(4) リザイン</h4>
<p class="contents">
・ダイス一覧画面の<button><i class="fas fa-flag"></i> Resign</button>を押下するとリザイン(負け宣言)です。<br>
　→本当にリザインするかどうかを<button><i class="fas fa-check-circle"></i> OK</button><button><i class="fas fa-times"></i> Cancel</button>で決定します。<br>
　→<button><i class="fas fa-check-circle"></i> OK</button>を押下するとゲーム終了です。<br>
　→得点は自動的に計算されます。<br>
　→シングル、ギャモン、バックギャモンの判定は<span onclick="showResignRule();" style="color:#00f">単純なロジック</span>で実装しています。<br>
</p>
<h4>(5) イリーガルムーブ</h4>
<p class="contents">
・[Allow input of illegal moves] にチェックするとイリーガルムーブの入力ができるようになります。<br>
　→掴んだチェッカーより前方のマスであればどこにでもムーブすることができます。<br>
　→この状態ではチェッカーをドラッグ＆ドロップで操作します。<br>
</p>
<h4>(6) 手順戻し</h4>
<p class="contents">
・<button><i class="fas fa-angle-double-left"></i> Rewind Action</button>を押下すると手順を戻すことができます。<br>
　→数手順前の棋譜入力ミスに気付いたときに使う機能です。<br>
　→ゲーム境界を越えて(前ゲームまで)戻すことは、敢えてできないようにしています。<br>
　→上記機能の副作用で、オープニングロールの出目は変更できません。<br>
</p>

<h4>(7) 棋譜ダウンロード</h4>
<p class="contents">
・<button><i class="fas fa-download"></i> Download Kifu</button>を押下すると棋譜をダウンロードできます。<br>
　→ダウンロードした棋譜ファイルはMAT形式のテキストファイルです。<br>
　→このファイルは eXtreme Gammon 2 や GnuBG などの解析ツールに読み込ませることができます。<br>
　→解析はこれらのツールで実行してください。<br>
</p>

<h3>◆ボタンとその機能</h3>

<p class="contents">
<table>
<tr><td><button><i class="fas fa-check"></i> Begin New Match</button>&emsp;</td><td>設定をクリアして新しいマッチの棋譜入力を始める</td></tr>
<tr><td><button><i class="fas fa-angle-double-left"></i> Rewind Action</button></td><td>入力した棋譜の手順を戻す</td></tr>
<tr><td><button><i class="fas fa-arrows-alt-h"></i> Flip Bearoff Side</button></td><td>ボードの左右を反転する</td></tr>
<tr><td><button><i class="fas fa-download"></i> Download Kifu</button></td><td>棋譜をダウンロードする</td></tr>
<tr><td><button><i class="fas fa-question"></i> Help</button></td><td>この説明書を開く</td></tr>
<tr><td><button><i class="fas fa-home"></i> Home</button></td><td>ホーム画面に戻る</td></tr>
</table>
</p>

<h3>◆分かっている（仕様という名の）問題点</h3>

<p class="contents">
・入力できるゲームはマッチゲームだけ<br>
・出力した棋譜ファイルを GnuBG で読み込んだとき、上側プレイヤーと下側プレイヤーの位置が入れ替わる<br>
・[Action Panel]をすばやくドラッグするとフォーカスを失うことがある。ゆっくりドラッグすれば大丈夫<br>
・右クリックはチェッカー部分のみ有効。三角形のマス部分を右クリックしても機能しない<br>
</p>

<h3>◆機能拡張履歴</h3>

<p class="contents">
(2023/05/18) 初版リリース<br>
(2023/05/19) クローズアウト時の<button><i class="fas fa-ban"></i> Dance</button>ボタンを実装<br>
(2023/05/20) 画面内に棋譜履歴を表示するよう機能拡張<br>
(2023/05/21) <button><i class="fas fa-check"></i> Begin New Match</button>押下時に確認ダイアログを表示。意図しない押下で悲しい思い(入力中の棋譜が消失)をしないように<br>
(2023/05/22) チェッカーではなく、三角形のマスの部分をクリックしてもムーブできるよう機能拡張<br>
(2023/05/23) リザイン時の確認ダイアログを[Action Panel]に統合<br>
(2023/05/26) フォーストムーブで自動的にチェッカーを動かす<button><i class="fas fa-dragon"></i> Forced</button>ボタンを実装<br>
(2023/06/01) 右クリックのときはダイスの小さい目を先に使うよう機能拡張<br>
</p>

<h3>◆追加するかもしれない機能</h3>

<p class="contents">
・リザイン時に得点を選択できる機能(<span onclick="showRuleDiff();" style="color:#00f">実ゲームとのルール齟齬</span>のためニーズ調査中)<br>
・And more...&emsp; Suggest new features, Please.<br>
</p>

<h3>◆その他</h3>

<p class="contents">
バグ報告や機能拡張要望は kawakami あっと js4.so-net.ne.jp にお願いします。<br>
対応するかどうかは期待しないでくださいね。Beer Donation Please... (^_^)u<br>
<br>
(C)hinacoppy 2023
</p>

<script src="/js/fontawesome-inuse.min.js"></script>
<script>
function showResignRule() {
  const msg = `リザイン時のスコア判定ロジック

(1)一枚でも上がっていれば、シングル負け
(2)コンタクトがあれば、バックギャモン負け
(3)自駒が19ptよりも後ろにあれば、バックギャモン負け
(4)それ以外は、ギャモン負け`;

  alert(msg);
}

function showRuleDiff() {
  const msg = `\
実ゲームでのリザイン時の得点は、その局面の最大負け点数。
それより少ない点数でのリザインはルール違反。

実際にはリザイン時に負け得点を宣言することがあるが、
その得点になることの双方の合意が取れているから。

棋譜入力ツールにその合意機能は必要なのだろうか？
もう少し局面を進めれば自動判断できる状態になるのに。。`;

  alert(msg);
}
</script>
</body>
</html>
